# é£ä¹¦ç¾¤æœºå™¨äººåˆ›å»ºä¸é…ç½®æŒ‡å—

## ä¸¤ç§é£ä¹¦æœºå™¨äººç±»å‹

### 1. é£ä¹¦è‡ªå®šä¹‰æœºå™¨äººï¼ˆWebhookï¼‰- å½“å‰ä½¿ç”¨
**ç‰¹ç‚¹ï¼š**
- âœ… é…ç½®ç®€å•ï¼Œæ— éœ€å®¡æ‰¹
- âœ… åªéœ€è·å–Webhook URLå³å¯å‘é€æ¶ˆæ¯
- âŒ **ä¸æ”¯æŒ@åŠŸèƒ½**ï¼ˆå¹³å°é™åˆ¶ï¼‰
- âŒ æ— æƒé™è·å–ç¾¤æˆå‘˜ä¿¡æ¯
- âŒ ä¸èƒ½ä¸»åŠ¨ç»™ç”¨æˆ·å‘æ¶ˆæ¯

**é€‚ç”¨åœºæ™¯ï¼š** å‘é€é€šçŸ¥ã€æ—¥æŠ¥ã€æŠ¥è­¦ç­‰å•å‘æ¶ˆæ¯

### 2. é£ä¹¦å®˜æ–¹æœºå™¨äººï¼ˆå¼€æ”¾å¹³å°ï¼‰- æ¨è
**ç‰¹ç‚¹ï¼š**
- âœ… æ”¯æŒ@æ‰€æœ‰äººã€@ç‰¹å®šæˆå‘˜
- âœ… å¯ä»¥ä¸»åŠ¨ç»™ç”¨æˆ·å‘æ¶ˆæ¯
- âœ… å¯ä»¥è·å–ç¾¤æˆå‘˜åˆ—è¡¨
- âœ… åŠŸèƒ½å¼ºå¤§ï¼ŒAPIä¸°å¯Œ
- âŒ éœ€è¦ä¼ä¸šè®¤è¯
- âŒ é…ç½®ç›¸å¯¹å¤æ‚
- âŒ éœ€è¦ç”³è¯·æƒé™

**é€‚ç”¨åœºæ™¯ï¼š** éœ€è¦äº¤äº’ã€@æé†’ã€è·å–ç¾¤ä¿¡æ¯ç­‰

---

## æ–¹æ¡ˆä¸€ï¼šé£ä¹¦è‡ªå®šä¹‰æœºå™¨äººï¼ˆå½“å‰æ–¹å¼ï¼‰

### åˆ›å»ºæ­¥éª¤
1. æ‰“å¼€é£ä¹¦ç¾¤ç»„
2. ç‚¹å‡»å³ä¸Šè§’ "..." â†’ "ç¾¤è®¾ç½®"
3. é€‰æ‹© "ç¾¤æœºå™¨äºº" â†’ "æ·»åŠ æœºå™¨äºº"
4. ç‚¹å‡» "è‡ªå®šä¹‰æœºå™¨äºº"
5. é…ç½®æœºå™¨äººåç§°å’Œå¤´åƒ
6. å¤åˆ¶ç”Ÿæˆçš„ **Webhook URL**

### ä½¿ç”¨æ–¹å¼
```python
import requests

webhook_url = "https://open.feishu.cn/open-apis/bot/v2/hook/xxx"
payload = {
    "msg_type": "interactive",
    "card": {
        "header": {
            "title": {"tag": "plain_text", "content": "æ ‡é¢˜"}
        },
        "elements": [{
            "tag": "div",
            "text": {"tag": "lark_md", "content": "**æ¶ˆæ¯å†…å®¹**"}
        }]
    }
}
requests.post(webhook_url, json=payload)
```

### âš ï¸ é™åˆ¶
- æ— æ³•ä½¿ç”¨ `<at user_id="all">æ‰€æœ‰äºº</at>` è¿™æ ·çš„@è¯­æ³•
- æ— æ³•çœŸæ­£@ç¾¤æˆå‘˜
- ä¸ä¼šè§¦å‘æ¨é€é€šçŸ¥

---

## æ–¹æ¡ˆäºŒï¼šé£ä¹¦å®˜æ–¹æœºå™¨äººï¼ˆæ¨èå®ç°@åŠŸèƒ½ï¼‰

### å‰ææ¡ä»¶
1. éœ€è¦é£ä¹¦ä¼ä¸šè®¤è¯è´¦å·
2. éœ€è¦åœ¨é£ä¹¦å¼€æ”¾å¹³å°åˆ›å»ºåº”ç”¨
3. éœ€è¦ç”³è¯·ç›¸å…³æƒé™

### åˆ›å»ºæ­¥éª¤

#### 1. åˆ›å»ºé£ä¹¦åº”ç”¨
1. è®¿é—® [é£ä¹¦å¼€æ”¾å¹³å°](https://open.feishu.cn/)
2. ç™»å½•é£ä¹¦è´¦å·
3. ç‚¹å‡» "åˆ›å»ºä¼ä¸šè‡ªå»ºåº”ç”¨"
4. å¡«å†™åº”ç”¨åç§°å’Œæè¿°
5. åˆ›å»ºæˆåŠŸåä¼šè·å¾— **App ID** å’Œ **App Secret**

#### 2. ç”³è¯·æƒé™
åœ¨åº”ç”¨ç®¡ç†é¡µé¢ï¼Œéœ€è¦ç”³è¯·ä»¥ä¸‹æƒé™ï¼š

**æ¶ˆæ¯æƒé™ï¼š**
- `im:message` - å‘é€æ¶ˆæ¯æƒé™
- `im:message:group_at_msg` - å‘é€ç¾¤ç»„@æ¶ˆæ¯
- `im:message:send_as_bot` - ä»¥æœºå™¨äººèº«ä»½å‘é€æ¶ˆæ¯

**ç¾¤ç»„æƒé™ï¼š**
- `im:chat` - è·å–ç¾¤ç»„ä¿¡æ¯
- `im:chat:member` - è·å–ç¾¤æˆå‘˜åˆ—è¡¨

**ç”¨æˆ·æƒé™ï¼š**
- `contact:user.base:readonly` - è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯

#### 3. å‘å¸ƒåº”ç”¨
1. åœ¨åº”ç”¨ç®¡ç†é¡µé¢ï¼Œç‚¹å‡» "ç‰ˆæœ¬ç®¡ç†ä¸å‘å¸ƒ"
2. åˆ›å»ºæ–°ç‰ˆæœ¬
3. æäº¤å®¡æ ¸
4. å®¡æ ¸é€šè¿‡åå‘å¸ƒ

#### 4. æ·»åŠ åˆ°ç¾¤ç»„
1. æ‰“å¼€é£ä¹¦ç¾¤ç»„
2. ç‚¹å‡»å³ä¸Šè§’ "..." â†’ "ç¾¤è®¾ç½®"
3. é€‰æ‹© "ç¾¤æœºå™¨äºº" â†’ "æ·»åŠ æœºå™¨äºº"
4. æœç´¢å¹¶é€‰æ‹©ä½ åˆ›å»ºçš„åº”ç”¨

#### 5. è·å–Access Token
```python
import requests

APP_ID = "your_app_id"
APP_SECRET = "your_app_secret"

# è·å– tenant_access_token
url = "https://open.feishu.cn/open-apis/auth/v3/tenant_access_token/internal"
payload = {
    "app_id": APP_ID,
    "app_secret": APP_SECRET
}
response = requests.post(url, json=payload)
tenant_access_token = response.json()['tenant_access_token']
```

#### 6. è·å–ç¾¤ç»„ä¿¡æ¯
```python
# è·å–ç¾¤ç»„çš„ chat_id
url = f"https://open.feishu.cn/open-apis/im/v1/chats"
headers = {"Authorization": f"Bearer {tenant_access_token}"}
response = requests.get(url, headers=headers)
chats = response.json()['data']['items']

# æ‰¾åˆ°ç›®æ ‡ç¾¤ç»„çš„ chat_id
for chat in chats:
    if chat['name'] == "ä½ çš„ç¾¤åç§°":
        chat_id = chat['chat_id']
        break
```

#### 7. å‘é€@æ‰€æœ‰äººçš„æ¶ˆæ¯
```python
# å‘é€æ¶ˆæ¯å¹¶@æ‰€æœ‰äºº
url = f"https://open.feishu.cn/open-apis/im/v1/messages?receive_id_type=chat_id"
headers = {
    "Authorization": f"Bearer {tenant_access_token}",
    "Content-Type": "application/json"
}

payload = {
    "receive_id": chat_id,
    "msg_type": "interactive",
    "content": {
        "config": {"wide_screen_mode": True},
        "header": {
            "title": {"tag": "plain_text", "content": "ğŸš¨ æ”¶å…¥å¼‚å¸¸æŠ¥è­¦"}
        },
        "elements": [
            {
                "tag": "div",
                "text": {
                    "tag": "lark_md",
                    "content": "**ã€è¯·æ‰€æœ‰äººæ³¨æ„ã€‘**\næ˜¨æ—¥æ”¶å…¥è¾ƒå‰æ—¥ä¸‹é™ **50.00%**ï¼Œè¯·åŠæ—¶å…³æ³¨ï¼"
                }
            },
            {
                "tag": "div",
                "text": {
                    "tag": "lark_md",
                    "content": "<at user_id=\"all\">æ‰€æœ‰äºº</at>"
                }
            }
        ]
    }
}

response = requests.post(url, headers=headers, json=payload)
message_id = response.json()['data']['message_id']
```

#### 8. å‘é€@ç‰¹å®šæˆå‘˜çš„æ¶ˆæ¯
```python
# å‘é€æ¶ˆæ¯å¹¶@ç‰¹å®šæˆå‘˜
elements = [
    {
        "tag": "div",
        "text": {
            "tag": "lark_md",
            "content": "<at user_id=\"ou_xxxxxxxxxxxxxxxx\">@å¨„æ™“é¹</at> è¯·æ³¨æ„ï¼"
        }
    }
]
```

---

## å¯¹æ¯”æ€»ç»“

| ç‰¹æ€§ | è‡ªå®šä¹‰Webhook | å®˜æ–¹æœºå™¨äºº |
|------|--------------|-----------|
| é…ç½®éš¾åº¦ | ç®€å• | å¤æ‚ |
| éœ€è¦ä¼ä¸šè®¤è¯ | å¦ | æ˜¯ |
| æ”¯æŒ@æ‰€æœ‰äºº | âŒ | âœ… |
| æ”¯æŒ@ç‰¹å®šæˆå‘˜ | âŒ | âœ… |
| è·å–ç¾¤æˆå‘˜ | âŒ | âœ… |
| ä¸»åŠ¨å‘æ¶ˆæ¯ | âŒ | âœ… |
| æ¨é€é€šçŸ¥ | âŒ | âœ… |
| é€‚ç”¨åœºæ™¯ | é€šçŸ¥ã€æ—¥æŠ¥ | äº¤äº’ã€æŠ¥è­¦ |

---

## æ¨èæ–¹æ¡ˆ

### å½“å‰é˜¶æ®µï¼ˆå¿«é€Ÿå®ç°ï¼‰
ç»§ç»­ä½¿ç”¨**è‡ªå®šä¹‰Webhookæœºå™¨äºº** + **é†’ç›®æ–‡æœ¬æç¤º**
- é…ç½®ç®€å•ï¼Œç«‹å³å¯ç”¨
- ä½¿ç”¨ğŸš¨å›¾æ ‡å’Œç²—ä½“æ–‡æœ¬æé†’
- è™½ç„¶ä¸è§¦å‘æ¨é€ï¼Œä½†è¶³å¤Ÿé†’ç›®

### å¦‚æœéœ€è¦çœŸæ­£çš„@åŠŸèƒ½
åˆ‡æ¢åˆ°**é£ä¹¦å®˜æ–¹æœºå™¨äºº**ï¼š
1. åœ¨é£ä¹¦å¼€æ”¾å¹³å°åˆ›å»ºåº”ç”¨
2. ç”³è¯·æ¶ˆæ¯æƒé™å’Œç¾¤ç»„æƒé™
3. å‘å¸ƒåº”ç”¨å¹¶æ·»åŠ åˆ°ç¾¤ç»„
4. ä½¿ç”¨å®˜æ–¹APIå‘é€æ¶ˆæ¯å¹¶@æˆå‘˜

---

## éœ€è¦å¸®åŠ©å—ï¼Ÿ

å¦‚æœä½ æƒ³åˆ‡æ¢åˆ°é£ä¹¦å®˜æ–¹æœºå™¨äººï¼Œæˆ‘å¯ä»¥å¸®ä½ ï¼š
1. ä¿®æ”¹ç°æœ‰çš„ä»£ç ä»¥ä½¿ç”¨å®˜æ–¹API
2. é…ç½®Access Tokenè·å–
3. å®ç°çœŸæ­£çš„@æ‰€æœ‰äººåŠŸèƒ½
4. å®ç°@ç‰¹å®šæˆå‘˜åŠŸèƒ½

éœ€è¦æˆ‘å¸®ä½ å®ç°å—ï¼Ÿ
